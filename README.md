# 中国象棋 Vue3 项目设计文档

## 项目概述
基于example.html开发一个现代化的中国象棋游戏，使用Vue3框架实现前端，Flask实现后端API，采用前后端分离架构。游戏将保留原有功能并优化界面和用户体验。

## 技术栈
- 前端：
  - Vue3 (Composition API)
  - Vite (构建工具)
  - HTML5 Canvas (棋盘渲染)
  - CSS3 (样式和动画)
  - Axios (API通信)
- 后端：
  - Flask (RESTful API)
  - Python (象棋引擎)

## 项目结构
```
chinese-chess-project/
├── frontend/                    # 前端Vue应用
│   ├── public/
│   │   ├── favicon.ico
│   │   └── sound/              # 棋子移动、吃子音效
│   ├── src/
│   │   ├── assets/
│   │   │   └── styles/         # 全局样式
│   │   ├── components/
│   │   │   ├── ChessBoard.vue  # 棋盘组件
│   │   │   ├── ChessPiece.vue  # 棋子组件
│   │   │   ├── GamePanel.vue   # 游戏控制面板
│   │   │   └── MoveHistory.vue # 棋谱记录
│   │   ├── composables/
│   │   │   ├── useChessGame.js # 游戏逻辑
│   │   │   ├── useChessRules.js # 棋子规则
│   │   │   └── useApi.js       # API通信
│   │   ├── services/
│   │   │   └── api.js          # API调用封装
│   │   ├── App.vue
│   │   └── main.js
│   ├── .gitignore
│   ├── index.html
│   ├── package.json
│   └── vite.config.js
│
├── backend/                     # 后端Flask应用
│   ├── app.py                   # Flask应用入口
│   ├── config.py                # 配置文件
│   ├── api/
│   │   ├── __init__.py
│   │   ├── routes.py            # API路由
│   │   └── validators.py        # 请求验证
│   ├── chess_engine/            # 象棋引擎
│   │   ├── __init__.py
│   │   ├── board.py             # 棋盘状态管理
│   │   └── rules.py             # 棋子规则实现
│   ├── tests/                   # 测试目录
│   │   ├── __init__.py
│   │   ├── test_api.py
│   │   └── test_chess_engine.py
│   ├── requirements.txt
│   └── README.md                # 后端文档
│
└── README.md                    # 项目主文档
```

## 核心功能模块

### 前端模块

#### 1. 棋盘模块 (ChessBoard.vue)
- 棋盘初始化与绘制
- 网格线、楚河汉界等元素绘制
- 事件处理（点击、拖拽）

#### 2. 棋子模块
- 棋子数据管理
- 棋子绘制与渲染
- 棋子选中状态处理

#### 3. 游戏规则模块
- 各类棋子移动规则实现
- 吃子规则
- 将/帅特殊规则处理

#### 4. 游戏控制模块
- 游戏状态管理
- 玩家轮换
- 悔棋、重新开始

#### 5. API通信模块
- 与后端API交互
- 处理数据传输和响应

### 后端模块

#### 1. API路由模块
- 处理HTTP请求
- 路由管理
- 请求验证

#### 2. 象棋引擎模块
- 棋盘状态管理
- 棋子移动规则实现
- 走法验证

## 数据结构设计

### 棋子数据结构
```javascript
{
  x: Number,        // 棋盘x坐标(0-8)
  y: Number,        // 棋盘y坐标(0-9)
  text: String,     // 棋子名称
  color: String,    // 文字颜色
  bgcolor: String,  // 背景色
  bgColor_b: String, // 边框色
  type: String      // 红/黑方("red"/"black")
}
```

### 游戏状态
```javascript
{
  currentPlayer: String,    // 当前回合("red"/"black")
  selectedPiece: Object,    // 当前选中棋子
  isChecked: Boolean,       // 是否有选中棋子
  moves: Array,             // 棋谱记录
  gameOver: Boolean,        // 游戏是否结束
  winner: String            // 获胜方
}
```

## 核心逻辑实现

### 1. 用户交互流程
```
用户点击 -> 获取坐标 -> 检查是否有棋子
  -> 有棋子 -> 检查是否为当前回合方棋子
    -> 是 -> 选中棋子并显示可走位置
    -> 否 -> 检查是否可吃子，若可吃则执行吃子
  -> 无棋子 -> 检查是否可移动，若可移动则执行移动
```

### 2. 棋子移动规则实现
- 车：直线移动，不能越子
- 马：日字形移动，不能蹩马腿
- 象/相：田字格移动，不能过河，不能越子
- 士/仕：斜线移动，限制在九宫格内
- 将/帅：上下左右移动，限制在九宫格内，可直线对杀
- 兵/卒：未过河只能前进，过河后可左右移动
- 炮：直线移动，吃子需要隔一个棋子

### 3. 记谱方式
中国象棋传统记谱法，如"炮二平五"、"马八进七"

## 界面设计
- 现代简约风格
- 响应式设计，适配不同设备
- 棋子选中和移动动画效果
- 游戏状态清晰显示

## 游戏功能
- 单机对战
- 悔棋功能
- 重新开始

## 前后端通信

### API设计原则
- RESTful风格API
- JSON格式数据交换
- 无状态设计，每次请求包含完整棋盘状态
- 使用HTTPS确保通信安全

## 后端设计

### Flask REST API结构

后端采用Flask框架构建REST风格的API，为前端提供象棋AI引擎的支持。

### API端点设计

#### 1. 移动棋子 API

- **URL**: `/api/move`
- **方法**: POST
- **参数**:
  - `board`: 字符串，表示当前棋盘状态
  - `move`: 字符串，表示移动动作
  
- **返回**:
  - `board`: 字符串，表示移动后的棋盘状态
  - `status`: 字符串，表示移动结果状态
  - `message`: 字符串，提供额外信息

### 棋盘表示法

棋盘使用一个字符串来表示所有棋子的位置，每个棋子由两位数字表示其坐标。

- 棋盘左上角为坐标 (0,0)
- 棋盘右下角为坐标 (8,9)
- 99 表示该棋子不在棋盘上（被吃掉或尚未使用）

例如：`3134293949596999584748264486999914222030405060996606420323436483`

这个字符串中，每两位数字代表一个棋子的位置：
- 前32个数字（16个坐标对）代表红方的16个棋子
- 后32个数字（16个坐标对）代表黑方的16个棋子

### 移动表示法

移动操作由4位数字组成，例如 `6443`：
- 前两位 `64` 表示起始位置坐标 (6,4)
- 后两位 `43` 表示目标位置坐标 (4,3)

### 实现逻辑

1. API接收棋盘状态字符串和移动操作字符串
2. 解析棋盘状态字符串，创建棋盘对象
3. 验证移动操作是否合法
   - 检查起始位置是否有棋子
   - 验证棋子移动规则
   - 检查是否有障碍物
4. 执行移动操作
   - 如果目标位置有对方棋子则执行吃子
   - 更新棋盘状态
5. 返回新的棋盘状态字符串
